import { HttpClient } from '@angular/common/http';
import { Inject, Injectable } from '@angular/core';
import { getKeyFromModel } from '@briebug/ngrx-auto-entity';
import { first, from, of, switchMap } from 'rxjs';
import { map } from 'rxjs/operators';
import { buildUrl, resolveRetryCriteria } from './entity.service.utils';
import { AUTO_ENTITY_CONFIG } from './config';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class EntityService {
    constructor(http, config) {
        this.http = http;
        this.config = config;
    }
    getUrlPrefix(operation, info, criteria) {
        return typeof this.config.urlPrefix === 'string' ? of(this.config.urlPrefix) : from(this.config.urlPrefix(operation, info, criteria));
    }
    buildUrl(operation, info, criteria, key) {
        return this.getUrlPrefix('load', info, criteria).pipe(first(), map(prefix => buildUrl(prefix, info, criteria, key)));
    }
    load(entityInfo, key, criteria) {
        return this.buildUrl('load', entityInfo, criteria, key).pipe(switchMap(url => resolveRetryCriteria(this.http.get(url), criteria?.retry, this.config.defaultRetry)));
    }
    loadMany(entityInfo, criteria) {
        return this.buildUrl('loadMany', entityInfo, criteria).pipe(switchMap(url => resolveRetryCriteria(this.http.get(url), criteria?.retry, this.config.defaultRetry)));
    }
    loadAll(entityInfo, criteria) {
        return this.buildUrl('loadAll', entityInfo, criteria).pipe(switchMap(url => resolveRetryCriteria(this.http.get(url), criteria?.retry, this.config.defaultRetry)));
    }
    create(entityInfo, entity, criteria, originalEntity) {
        return this.buildUrl('create', entityInfo, criteria).pipe(switchMap(url => this.http.post(url, entity)));
    }
    update(entityInfo, entity, criteria, originalEntity) {
        return this.buildUrl('update', entityInfo, criteria, getKeyFromModel(entityInfo.modelType, entity)).pipe(switchMap(url => this.http.patch(url, entity)));
    }
    replace(entityInfo, entity, criteria, originalEntity) {
        return this.buildUrl('replace', entityInfo, criteria, getKeyFromModel(entityInfo.modelType, entity)).pipe(switchMap(url => this.http.put(url, entity)));
    }
    delete(entityInfo, entity, criteria, originalEntity) {
        return this.buildUrl('delete', entityInfo, criteria, getKeyFromModel(entityInfo.modelType, entity)).pipe(switchMap(url => this.http.delete(url, entity).pipe(map(() => entity))));
    }
    deleteByKey(entityInfo, key, criteria) {
        return this.buildUrl('deleteByKey', entityInfo, criteria, key).pipe(switchMap(url => this.http.delete(url).pipe(map(() => key))));
    }
    /** @nocollapse */ static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: EntityService, deps: [{ token: i1.HttpClient }, { token: AUTO_ENTITY_CONFIG }], target: i0.ɵɵFactoryTarget.Injectable }); }
    /** @nocollapse */ static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: EntityService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.2", ngImport: i0, type: EntityService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [AUTO_ENTITY_CONFIG]
                }] }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW50aXR5LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3J4LWF1dG8tZW50aXR5LXNlcnZpY2Uvc3JjL2xpYi9lbnRpdHkuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFrQixlQUFlLEVBQW1DLE1BQU0sMkJBQTJCLENBQUM7QUFDN0csT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQWMsRUFBRSxFQUFFLFNBQVMsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM5RCxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDckMsT0FBTyxFQUFFLFFBQVEsRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxrQkFBa0IsRUFBMkIsTUFBTSxVQUFVLENBQUM7OztBQUl2RSxNQUFNLE9BQU8sYUFBYTtJQUN4QixZQUNtQixJQUFnQixFQUVoQixNQUErQjtRQUYvQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBRWhCLFdBQU0sR0FBTixNQUFNLENBQXlCO0lBQy9DLENBQUM7SUFFTSxZQUFZLENBQUMsU0FBaUIsRUFBRSxJQUFpQixFQUFFLFFBQXlCO1FBQ3BGLE9BQU8sT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ3hJLENBQUM7SUFFUyxRQUFRLENB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SSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQU0sR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQ2xELENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLFVBQXVCLEVBQUUsTUFBVyxFQUFFLFFBQXlCLEVBQUUsY0FBb0I7UUFDMUYsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLGVBQWUsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUN0RyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBTSxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQzdFLENBQUM7SUFDSixDQUFDO0lBRUQsV0FBVyxDQUFDLFVBQXVCLEVBQUUsR0FBbUIsRUFBRSxRQUF5QjtRQUNqRixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekksQ0FBQztpSUE1RFUsYUFBYSw0Q0FHZCxrQkFBa0I7cUlBSGpCLGFBQWE7OzJGQUFiLGFBQWE7a0JBRHpCLFVBQVU7OzBCQUlOLE1BQU07MkJBQUMsa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRW50aXR5SWRlbnRpdHksIGdldEtleUZyb21Nb2RlbCwgSUF1dG9FbnRpdHlTZXJ2aWNlLCBJRW50aXR5SW5mbyB9IGZyb20gJ0BicmllYnVnL25ncngtYXV0by1lbnRpdHknO1xuaW1wb3J0IHsgZmlyc3QsIGZyb20sIE9ic2VydmFibGUsIG9mLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IGJ1aWxkVXJsLCByZXNvbHZlUmV0cnlDcml0ZXJpYSB9IGZyb20gJy4vZW50aXR5LnNlcnZpY2UudXRpbHMnO1xuaW1wb3J0IHsgQVVUT19FTlRJVFlfQ09ORklHLCBBdXRvRW50aXR5U2VydmljZUNvbmZpZyB9IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7IEVudGl0eUNyaXRlcmlhIH0gZnJvbSAnLi9jcml0ZXJhLm1vZGVsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEVudGl0eVNlcnZpY2UgaW1wbGVtZW50cyBJQXV0b0VudGl0eVNlcnZpY2U8YW55PiB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgaHR0cDogSHR0cENsaWVudCxcbiAgICBASW5qZWN0KEFVVE9fRU5USVRZX0NPTkZJRylcbiAgICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZzogQXV0b0VudGl0eVNlcnZpY2VDb25maWdcbiAgKSB7fVxuXG4gIHByb3RlY3RlZCBnZXRVcmxQcmVmaXgob3BlcmF0aW9uOiBzdHJpbmcsIGluZm86IElFbnRpdHlJbmZvLCBjcml0ZXJpYT86IEVudGl0eUNyaXRlcmlhKTogT2JzZXJ2YWJsZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gdHlwZW9mIHRoaXMuY29uZmlnLnVybFByZWZpeCA9PT0gJ3N0cmluZycgPyBvZih0aGlzLmNvbmZpZy51cmxQcmVmaXgpIDogZnJvbSh0aGlzLmNvbmZpZy51cmxQcmVmaXgob3BlcmF0aW9uLCBpbmZvLCBjcml0ZXJpYSkpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGJ1aWxkVXJsKG9wZXJhdGlvbjogc3RyaW5nLCBpbmZvOiBJRW50aXR5SW5mbywgY3JpdGVyaWE/OiBFbnRpdHlDcml0ZXJpYSwga2V5Pzogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VXJsUHJlZml4KCdsb2FkJywgaW5mbywgY3JpdGVyaWEpLnBpcGUoXG4gICAgICBmaXJzdCgpLFxuICAgICAgbWFwKHByZWZpeCA9PiBidWlsZFVybChwcmVmaXgsIGluZm8sIGNyaXRlcmlhLCBrZXkpKVxuICAgICk7XG4gIH1cblxuICBsb2FkKGVudGl0eUluZm86IElFbnRpdHlJbmZvLCBrZXk6IGFueSwgY3JpdGVyaWE/OiBFbnRpdHlDcml0ZXJpYSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRVcmwoJ2xvYWQnLCBlbnRpdHlJbmZvLCBjcml0ZXJpYSwga2V5KS5waXBlKFxuICAgICAgc3dpdGNoTWFwKHVybCA9PiByZXNvbHZlUmV0cnlDcml0ZXJpYSh0aGlzLmh0dHAuZ2V0PGFueT4odXJsKSwgY3JpdGVyaWE/LnJldHJ5LCB0aGlzLmNvbmZpZy5kZWZhdWx0UmV0cnkpKVxuICAgICk7XG4gIH1cblxuICBsb2FkTWFueShlbnRpdHlJbmZvOiBJRW50aXR5SW5mbywgY3JpdGVyaWE/OiBFbnRpdHlDcml0ZXJpYSk6IE9ic2VydmFibGU8YW55W10+IHtcbiAgICByZXR1cm4gdGhpcy5idWlsZFVybCgnbG9hZE1hbnknLCBlbnRpdHlJbmZvLCBjcml0ZXJpYSkucGlwZShcbiAgICAgIHN3aXRjaE1hcCh1cmwgPT4gcmVzb2x2ZVJldHJ5Q3JpdGVyaWEodGhpcy5odHRwLmdldDxhbnlbXT4odXJsKSwgY3JpdGVyaWE/LnJldHJ5LCB0aGlzLmNvbmZpZy5kZWZhdWx0UmV0cnkpKVxuICAgICk7XG4gIH1cblxuICBsb2FkQWxsKGVudGl0eUluZm86IElFbnRpdHlJbmZvLCBjcml0ZXJpYT86IEVudGl0eUNyaXRlcmlhKTogT2JzZXJ2YWJsZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLmJ1aWxkVXJsKCdsb2FkQWxsJywgZW50aXR5SW5mbywgY3JpdGVyaWEpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAodXJsID0+IHJlc29sdmVSZXRyeUNyaXRlcmlhKHRoaXMuaHR0cC5nZXQ8YW55W10+KHVybCksIGNyaXRlcmlhPy5yZXRyeSwgdGhpcy5jb25maWcuZGVmYXVsdFJldHJ5KSlcbiAgICApO1xuICB9XG5cbiAgY3JlYXRlKGVudGl0eUluZm86IElFbnRpdHlJbmZvLCBlbnRpdHk6IGFueSwgY3JpdGVyaWE/OiBFbnRpdHlDcml0ZXJpYSwgb3JpZ2luYWxFbnRpdHk/OiBhbnkpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmJ1aWxkVXJsKCdjcmVhdGUnLCBlbnRpdHlJbmZvLCBjcml0ZXJpYSkucGlwZShzd2l0Y2hNYXAodXJsID0+IHRoaXMuaHR0cC5wb3N0PGFueT4odXJsLCBlbnRpdHkpKSk7XG4gIH1cblxuICB1cGRhdGUoZW50aXR5SW5mbzogSUVudGl0eUluZm8sIGVudGl0eTogYW55LCBjcml0ZXJpYT86IEVudGl0eUNyaXRlcmlhLCBvcmlnaW5hbEVudGl0eT86IGFueSk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRVcmwoJ3VwZGF0ZScsIGVudGl0eUluZm8sIGNyaXRlcmlhLCBnZXRLZXlGcm9tTW9kZWwoZW50aXR5SW5mby5tb2RlbFR5cGUsIGVudGl0eSkpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAodXJsID0+IHRoaXMuaHR0cC5wYXRjaDxhbnk+KHVybCwgZW50aXR5KSlcbiAgICApO1xuICB9XG5cbiAgcmVwbGFjZShlbnRpdHlJbmZvOiBJRW50aXR5SW5mbywgZW50aXR5OiBhbnksIGNyaXRlcmlhPzogRW50aXR5Q3JpdGVyaWEsIG9yaWdpbmFsRW50aXR5PzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5idWlsZFVybCgncmVwbGFjZScsIGVudGl0eUluZm8sIGNyaXRlcmlhLCBnZXRLZXlGcm9tTW9kZWwoZW50aXR5SW5mby5tb2RlbFR5cGUsIGVudGl0eSkpLnBpcGUoXG4gICAgICBzd2l0Y2hNYXAodXJsID0+IHRoaXMuaHR0cC5wdXQ8YW55Pih1cmwsIGVudGl0eSkpXG4gICAgKTtcbiAgfVxuXG4gIGRlbGV0ZShlbnRpdHlJbmZvOiBJRW50aXR5SW5mbywgZW50aXR5OiBhbnksIGNyaXRlcmlhPzogRW50aXR5Q3JpdGVyaWEsIG9yaWdpbmFsRW50aXR5PzogYW55KTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5idWlsZFVybCgnZGVsZXRlJywgZW50aXR5SW5mbywgY3JpdGVyaWEsIGdldEtleUZyb21Nb2RlbChlbnRpdHlJbmZvLm1vZGVsVHlwZSwgZW50aXR5KSkucGlwZShcbiAgICAgIHN3aXRjaE1hcCh1cmwgPT4gdGhpcy5odHRwLmRlbGV0ZTxhbnk+KHVybCwgZW50aXR5KS5waXBlKG1hcCgoKSA9PiBlbnRpdHkpKSlcbiAgICApO1xuICB9XG5cbiAgZGVsZXRlQnlLZXkoZW50aXR5SW5mbzogSUVudGl0eUluZm8sIGtleTogRW50aXR5SWRlbnRpdHksIGNyaXRlcmlhPzogRW50aXR5Q3JpdGVyaWEpOiBPYnNlcnZhYmxlPEVudGl0eUlkZW50aXR5PiB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRVcmwoJ2RlbGV0ZUJ5S2V5JywgZW50aXR5SW5mbywgY3JpdGVyaWEsIGtleSkucGlwZShzd2l0Y2hNYXAodXJsID0+IHRoaXMuaHR0cC5kZWxldGU8YW55Pih1cmwpLnBpcGUobWFwKCgpID0+IGtleSkpKSk7XG4gIH1cbn1cbiJdfQ==